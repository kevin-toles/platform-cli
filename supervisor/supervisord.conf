; =============================================================================
; AI Platform Supervisor Configuration
; =============================================================================
; WBS-LOG1: Supervisor Process Management
; Reference: WBS_CMS_DUAL_ROUTING_AND_LOGGING.md
;
; This configuration manages all 6 AI Platform services:
; - ai-agents (8082)
; - inference-service (8085)
; - llm-gateway (8080)
; - semantic-search (8081)
; - audit-service (8084)
; - context-management-service (8086)
;
; Usage:
;   supervisord -c /Users/kevintoles/POC/platform-cli/supervisor/supervisord.conf
;   supervisorctl -c /Users/kevintoles/POC/platform-cli/supervisor/supervisord.conf status
; =============================================================================

[unix_http_server]
file=/tmp/supervisor.sock   ; Path to the socket file
chmod=0700                  ; Socket file mode

[supervisord]
logfile=/Users/kevintoles/Library/Logs/ai-platform/supervisor/supervisord.log  ; Main log file
logfile_maxbytes=50MB                         ; Max log file size
logfile_backups=10                            ; Number of backups
loglevel=info                                 ; Log level
pidfile=/tmp/supervisord.pid                  ; PID file
nodaemon=false                                ; Run as daemon
minfds=1024                                   ; Min file descriptors
minprocs=200                                  ; Min process descriptors
user=kevintoles                               ; User to run as

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock  ; Use socket for connection

; Include individual service configurations
[include]
files = conf.d/*.conf

; =============================================================================
; Event Listener for Restart Logging (AC-LOG1.5)
; =============================================================================
[eventlistener:restart_logger]
command=/Users/kevintoles/POC/platform-cli/supervisor/event_listener.py
events=PROCESS_STATE_EXITED,PROCESS_STATE_STOPPED,PROCESS_STATE_STARTING
stdout_logfile=/var/log/supervisor/event_listener.log
stderr_logfile=/var/log/supervisor/event_listener_err.log
autorestart=true
